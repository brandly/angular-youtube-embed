angular.module("youtube-embed",["ng"]).service("youtubeEmbedUtils",["$window","$rootScope",function(e,t){function r(e,t){return e.indexOf(t)>-1}var n={},a=/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube(?:-nocookie)?\.com\S*[^\w\s-])([\w-]{11})(?=[^\w-]|$)(?![?=&+%\w.-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,i=/t=(\d+)[ms]?(\d+)?s?/;return n.getIdFromURL=function(e){var t=e.replace(a,"$1");if(r(t,";")){var n=t.split(";");if(r(n[1],"%")){var i=decodeURIComponent(t.split(";")[1]);t=("http://youtube.com"+i).replace(a,"$1")}else t=n[0]}else r(t,"#")&&(t=t.split("#")[0]);return t},n.getTimeFromURL=function(e){e=e||"";var t=e.match(i);if(!t)return 0;var n=t[0],a=t[1],o=t[2];return"undefined"!=typeof o?(o=parseInt(o,10),a=parseInt(a,10)):r(n,"m")?(a=parseInt(a,10),o=0):(o=parseInt(a,10),a=0),o+60*a},function(){var e=["http:","https:"],t="//www.youtube.com/iframe_api";e.indexOf(window.location.protocol)<0&&(t="http:"+t);var r=document.createElement("script");r.src=t;var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(r,n)}(),n.ready=!1,e.onYouTubeIframeAPIReady=function(){t.$apply(function(){n.ready=!0})},n}]).directive("youtubeVideo",["youtubeEmbedUtils",function(e){var t=1,r={"-1":"unstarted",0:"ended",1:"playing",2:"paused",3:"buffering",5:"queued"},n="youtube.player.";return{restrict:"EA",scope:{videoId:"=?",videoUrl:"=?",player:"=?",playerVars:"=?",playerHeight:"=?",playerWidth:"=?"},link:function(a,i,o){function u(){var e=Array.prototype.slice.call(arguments);a.$apply(function(){a.$emit.apply(a,e)})}function d(e){var t=r[e.data];"undefined"!=typeof t&&u(n+t,a.player,e),a.$apply(function(){a.player.currentState=t})}function p(e){u(n+"ready",a.player,e)}function l(){var e=new YT.Player(c,{height:a.playerHeight,width:a.playerWidth,videoId:a.videoId,playerVars:a.playerVars,events:{onReady:p,onStateChange:d}});return e.id=c,e}function y(){c&&a.videoId&&(a.player&&"function"==typeof a.player.destroy&&a.player.destroy(),a.player=l())}a.utils=e;var c=o.playerId||i[0].id||"unique-youtube-embed-id-"+t++;i[0].id=c,a.playerHeight=a.playerHeight||390,a.playerWidth=a.playerWidth||640,a.playerVars=a.playerVars||{};var s=a.$watch(function(){return a.utils.ready&&("undefined"!=typeof a.videoUrl||"undefined"!=typeof a.videoId)},function(e){e&&(s(),"undefined"!=typeof a.videoUrl?a.$watch("videoUrl",function(e){a.videoId=a.utils.getIdFromURL(e);var t=a.utils.getTimeFromURL(e);a.playerVars.start=a.playerVars.start||t,y()}):a.$watch("videoId",function(){y()}))})}}}]);